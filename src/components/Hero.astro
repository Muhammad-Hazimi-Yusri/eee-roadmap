---
import { getAllTracks, roadmaps } from '../data';
import RoadmapGraph from './RoadmapGraph.astro';

// Compute stats dynamically
const allTracks = getAllTracks();
const trackCount = allTracks.length;

let topicCount = 0;
let conceptCount = 0;

allTracks.forEach(({ slug }) => {
  const sections = roadmaps[slug]?.sections ?? [];
  sections.forEach(section => {
    topicCount += section.items.length;
    section.items.forEach(item => {
      conceptCount += item.concepts?.length ?? 0;
    });
  });
});

const stats = [
  { value: String(trackCount), label: 'tracks' },
  { value: String(topicCount), label: 'topics' },
  { value: String(conceptCount), label: 'concepts' },
  { value: 'MIT', label: 'license' },
];
---

<section class="section py-16 md:py-24">
  <div class="container">
    <p class="font-mono text-xs uppercase tracking-widest text-muted mb-2">
      // open source learning path
    </p>
    
    <h1 class="text-2xl sm:text-3xl md:text-4xl mb-4">
      Learn Electrical &amp; Electronic Engineering
    </h1>
    
    <p class="max-w-xl text-muted mb-6">
      A structured roadmap from circuit fundamentals to advanced power systems. 
      Interactive progress tracking for desktop (click) and tablet/stylus (swipe).
    </p>
    
    <div class="ai-warning mb-6">
      <p class="text-xs text-amber-600 dark:text-amber-400">
        ⚠️ <strong>AI-Generated Content:</strong> Descriptions, concepts, and resources have not been manually verified. Use as a guide, not authoritative reference.
      </p>
    </div>
    
    <div class="flex flex-wrap gap-4 mb-8">
      <a href="#demo" class="btn btn--primary">
        Try Demo ↓
      </a>
      <a href="#roadmaps" class="btn">
        View Tracks
      </a>
    </div>

    <div class="flex flex-wrap gap-8 pt-6 border-t" style="border-color: var(--color-border);">
      {stats.map((stat) => (
        <div class="flex items-baseline gap-2">
          <span class="stat-value">{stat.value}</span>
          <span class="stat-label">{stat.label}</span>
        </div>
      ))}
    </div>

    <!-- Roadmap Graph -->
    <div class="mt-8">
      <p class="font-mono text-xs uppercase tracking-widest text-muted mb-3">
        // topic connections
      </p>
      <RoadmapGraph />
    </div>
  </div>
</section>
